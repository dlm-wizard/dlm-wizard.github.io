<!-- TOC -->

- [1、解析器与解释器](#1-解析器与解释器)
    - [解析器（parser）](#解析器（parser）)
    - [解释器（interpreter）](#解释器（interpreter）)
    - [“解释型语言”到底是什么？](#“解释型语言”到底是什么？)
    - [虚拟机（virtual machine，VM）又是什么？](#虚拟机（virtual_machine，VM）又是什么？)
- [参考](#参考)

<!-- /TOC -->

## 1. 解析器与解释器

### 解析器（parser）

**编译器**的重要组成部分，也可以用在**IDE**之类的地方。其主要作用是进行语法分析，提取出句子的结构。

广义来说输入一般是程序的源码，输出一般是[抽象语法树（abstract syntax tree，AST）](https://en.wikipedia.org/wiki/Abstract_syntax_tree)。

- 扫描器（scanner，也叫tokenizer或者lexical analyzer，词法分析器）

```
扫描器的输入一般是文本，经过词法分析，输出是将文本切割为单词的流
```

- 解析器（parser，也叫syntax analyzer，语法分析器）

```
输入是单词的流，经过语法分析，输出是抽象语法树（AST）
```

在一些编译器中，解析也可能与后续的**语义分析、代码生成或解释执行**等步骤融合在一起，不一定真的会构造出完整的语法树。但概念上说解析器就是用来抽取句子结构用的，而语法树就是表示句子结构的方式。关于边解析边解释执行的例子，可以看看[这里的计算器](http://rednaxelafx.iteye.com/blog/472113)。

<div align="center">  <img src="解析器工作流" width="75%" height="75%" /></div><br>

### 解释器（interpreter）

解释器是实现程序执行的一种实现方式，它直接实现程序源码的语义，输入是程序源码，输出则是执行源码得到的计算结果

编译器的输入与解释器相同，而输出是用别的语言实现了输入源码的语义的程序。（也有可能是相同的语言，此时编译器主要用于优化代码）

<div align="center">  <img src="编译器与解释器" width="75%" height="75%" /></div><br>

### “解释型语言”到底是什么？

JavaScript是“解释型语言”，是通过解释器来实现的。这么说其实很容易引起误解：语言一般只会定义其抽象语义，而不会强制性要求采用某种实现方式。

一般被称为“解释型语言”的是主流实现为解释器的语言，但并不是说它就无法编译。解释器就是个黑箱，输入是源码，输出就是输入程序的执行结果,内部怎么实现（有无"编译"步骤）都没关系。

栗如，C一般被认为是“编译型语言”，你可以写一个C语言的解释器，里面只是先用普通的C编译器把源码编译为in-memory image，然后直接调用image去得到运行结果

实际上很多**解释器内部是以“编译器+虚拟机”的方式来实现的**，先通过编译器将源码转换为AST或者字节码，然后由虚拟机去完成实际的执行。**所谓“解释型语言”并不是不用编译，而只是不需要用户显式去使用编译器得到可执行代码而已。**

### 虚拟机（virtual_machine，VM）又是什么？

**编译器**的输出可能是AST，也可能是字节码之类的指令序列。一般会把执行前者的统称为解释器，执行后者的程序称为VM。

如果上下文是Java，那么一般指的是高级语言虚拟机，其意义是实现高级语言的语义。

输入是满足某种指令集架构（instruction set architecture，ISA）的指令序列，中间转换为目标ISA的指令序列并加以执行，输出为程序的执行结果的，就是VM。

VM 并不是神奇的就能执行代码了，它也得采用某种方式去实现输入程序的语义。

- 编译（JVM）

```
输入的指令先转换为某种能被底下的操作系统直接执行的形式（一般就是native code），然后再执行
```

- 解释

```
输入的指令逐条直接执行
```

采用编译和解释方式实现虚拟机最大的区别就在于是否存储目标代码。编译的话会把输入的源程序**翻译生成为目标代码，并存下来**。后续执行可以复用之；解释的话则是把源程序中的指令逐条解释，**不生成也不存下目标代码**，后续执行没有多少可复用的信息。

如果一种语言的主流实现是解释器，其内部是编译器+虚拟机，而虚拟机又是采用解释方式实现的（或内部是编译器+解释器），那它就是名副其实的“解释型语言”。


## 参考

[ Virtual Machine ](https://www.iteye.com/blog/rednaxelafx-492667)



